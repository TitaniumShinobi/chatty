<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lin Test Performance Dashboard</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #0a0a0a;
      color: #e0e0e0;
      padding: 20px;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1 {
      color: #4a9eff;
      margin-bottom: 10px;
    }
    
    .subtitle {
      color: #888;
      margin-bottom: 30px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 20px;
    }
    
    .stat-label {
      color: #888;
      font-size: 0.9em;
      margin-bottom: 8px;
    }
    
    .stat-value {
      font-size: 2em;
      font-weight: bold;
      color: #4a9eff;
    }
    
    .stat-grade {
      font-size: 3em;
      font-weight: bold;
    }
    
    .grade-a { color: #4caf50; }
    .grade-b { color: #8bc34a; }
    .grade-c { color: #ffc107; }
    .grade-d { color: #ff9800; }
    .grade-f { color: #f44336; }
    
    .chart-container {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 30px;
    }
    
    .chart-title {
      color: #4a9eff;
      margin-bottom: 20px;
      font-size: 1.2em;
    }
    
    .test-results {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 30px;
    }
    
    .test-item {
      padding: 15px;
      border-bottom: 1px solid #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .test-item:last-child {
      border-bottom: none;
    }
    
    .test-info {
      flex: 1;
    }
    
    .test-prompt {
      font-weight: bold;
      color: #e0e0e0;
      margin-bottom: 5px;
    }
    
    .test-level {
      color: #888;
      font-size: 0.9em;
    }
    
    .test-score {
      font-size: 1.5em;
      font-weight: bold;
      margin-right: 20px;
    }
    
    .score-5 { color: #4caf50; }
    .score-4 { color: #8bc34a; }
    .score-3 { color: #ffc107; }
    .score-2 { color: #ff9800; }
    .score-1 { color: #f44336; }
    .score-0 { color: #f44336; }
    
    .history-table {
      width: 100%;
      border-collapse: collapse;
      background: #1a1a1a;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .history-table th {
      background: #2a2a2a;
      padding: 12px;
      text-align: left;
      color: #4a9eff;
      border-bottom: 2px solid #333;
    }
    
    .history-table td {
      padding: 12px;
      border-bottom: 1px solid #333;
    }
    
    .history-table tr:hover {
      background: #252525;
    }
    
    .no-data {
      text-align: center;
      padding: 40px;
      color: #888;
    }
    
    .button {
      background: #4a9eff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1em;
      margin-right: 10px;
    }
    
    .button:hover {
      background: #3a8eef;
    }
    
    .button-secondary {
      background: #333;
      color: #e0e0e0;
    }
    
    .button-secondary:hover {
      background: #444;
    }
    
    .trend-up { color: #4caf50; }
    .trend-down { color: #f44336; }
    .trend-neutral { color: #888; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß™ Lin Test Performance Dashboard</h1>
    <p class="subtitle">Track Lin's conversational ability improvements over time</p>
    
    <div id="stats" class="stats-grid">
      <!-- Stats will be populated by JavaScript -->
    </div>
    
    <div class="chart-container">
      <div class="chart-title">üìà Performance Trend</div>
      <canvas id="trendChart" width="800" height="300"></canvas>
    </div>
    
    <div class="test-results">
      <div class="chart-title">üìä Latest Test Results</div>
      <div id="testResults">
        <!-- Test results will be populated by JavaScript -->
      </div>
    </div>
    
    <div class="chart-container">
      <div class="chart-title">üìú Test History</div>
      <table class="history-table" id="historyTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Grade</th>
            <th>Score</th>
            <th>Percentage</th>
            <th>Passed</th>
            <th>Failed</th>
          </tr>
        </thead>
        <tbody id="historyBody">
          <!-- History will be populated by JavaScript -->
        </tbody>
      </table>
    </div>
    
    <div style="margin-top: 30px;">
      <button class="button" onclick="refreshDashboard()">üîÑ Refresh</button>
      <button class="button button-secondary" onclick="exportData()">üíæ Export JSON</button>
      <button class="button button-secondary" onclick="clearHistory()">üóëÔ∏è Clear History</button>
    </div>
  </div>
  
  <script>
    function getTestHistory() {
      try {
        return JSON.parse(localStorage.getItem('linTestHistory') || '[]');
      } catch (error) {
        console.error('Failed to load test history:', error);
        return [];
      }
    }
    
    function getLatestReport() {
      try {
        return JSON.parse(localStorage.getItem('lastLinTestReport') || 'null');
      } catch (error) {
        return null;
      }
    }
    
    function renderStats() {
      const history = getTestHistory();
      const latest = history[history.length - 1];
      const statsDiv = document.getElementById('stats');
      
      if (!latest) {
        statsDiv.innerHTML = '<div class="no-data">No test data available. Run tests first!</div>';
        return;
      }
      
      const previous = history[history.length - 2];
      const trend = previous ? (latest.percentage - previous.percentage) : 0;
      const trendClass = trend > 0 ? 'trend-up' : trend < 0 ? 'trend-down' : 'trend-neutral';
      const trendSymbol = trend > 0 ? '‚Üë' : trend < 0 ? '‚Üì' : '‚Üí';
      
      statsDiv.innerHTML = `
        <div class="stat-card">
          <div class="stat-label">Current Grade</div>
          <div class="stat-value stat-grade grade-${latest.grade.toLowerCase()}">${latest.grade}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Score</div>
          <div class="stat-value">${latest.totalScore}/${latest.maxScore}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Percentage</div>
          <div class="stat-value">${latest.percentage.toFixed(1)}%</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Trend</div>
          <div class="stat-value ${trendClass}">${trendSymbol} ${Math.abs(trend).toFixed(1)}%</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Passed</div>
          <div class="stat-value">${latest.summary.passed}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Failed</div>
          <div class="stat-value">${latest.summary.failed}</div>
        </div>
      `;
    }
    
    function renderTestResults() {
      const latest = getLatestReport();
      const resultsDiv = document.getElementById('testResults');
      
      if (!latest || !latest.results) {
        resultsDiv.innerHTML = '<div class="no-data">No test results available</div>';
        return;
      }
      
      resultsDiv.innerHTML = latest.results.map(result => {
        const scoreClass = `score-${result.score}`;
        return `
          <div class="test-item">
            <div class="test-info">
              <div class="test-prompt">Level ${result.level}: "${result.prompt}"</div>
              <div class="test-level">${result.issues.length > 0 ? 'Issues: ' + result.issues.join(', ') : 'All criteria met'}</div>
            </div>
            <div class="test-score ${scoreClass}">${result.score}/5</div>
          </div>
        `;
      }).join('');
    }
    
    function renderHistory() {
      const history = getTestHistory();
      const tbody = document.getElementById('historyBody');
      
      if (history.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="no-data">No test history available</td></tr>';
        return;
      }
      
      tbody.innerHTML = history.slice().reverse().map(run => {
        const date = new Date(run.runDate || run.timestamp);
        return `
          <tr>
            <td>${date.toLocaleString()}</td>
            <td><span class="grade-${run.grade.toLowerCase()}">${run.grade}</span></td>
            <td>${run.totalScore}/${run.maxScore}</td>
            <td>${run.percentage.toFixed(1)}%</td>
            <td>${run.summary.passed}</td>
            <td>${run.summary.failed}</td>
          </tr>
        `;
      }).join('');
    }
    
    function renderTrendChart() {
      const history = getTestHistory();
      const canvas = document.getElementById('trendChart');
      const ctx = canvas.getContext('2d');
      
      if (history.length === 0) {
        ctx.fillStyle = '#888';
        ctx.font = '16px sans-serif';
        ctx.fillText('No data available', 50, 150);
        return;
      }
      
      const width = canvas.width;
      const height = canvas.height;
      const padding = 40;
      const chartWidth = width - padding * 2;
      const chartHeight = height - padding * 2;
      
      // Clear canvas
      ctx.fillStyle = '#1a1a1a';
      ctx.fillRect(0, 0, width, height);
      
      // Draw axes
      ctx.strokeStyle = '#333';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(padding, padding);
      ctx.lineTo(padding, height - padding);
      ctx.lineTo(width - padding, height - padding);
      ctx.stroke();
      
      // Draw data points
      const maxPercentage = 100;
      const points = history.map((run, index) => ({
        x: padding + (index / (history.length - 1 || 1)) * chartWidth,
        y: height - padding - (run.percentage / maxPercentage) * chartHeight
      }));
      
      // Draw line
      ctx.strokeStyle = '#4a9eff';
      ctx.lineWidth = 2;
      ctx.beginPath();
      points.forEach((point, i) => {
        if (i === 0) {
          ctx.moveTo(point.x, point.y);
        } else {
          ctx.lineTo(point.x, point.y);
        }
      });
      ctx.stroke();
      
      // Draw points
      ctx.fillStyle = '#4a9eff';
      points.forEach(point => {
        ctx.beginPath();
        ctx.arc(point.x, point.y, 4, 0, Math.PI * 2);
        ctx.fill();
      });
      
      // Draw labels
      ctx.fillStyle = '#888';
      ctx.font = '12px sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('Test Run', width / 2, height - 10);
      ctx.save();
      ctx.translate(15, height / 2);
      ctx.rotate(-Math.PI / 2);
      ctx.fillText('Percentage (%)', 0, 0);
      ctx.restore();
    }
    
    function refreshDashboard() {
      renderStats();
      renderTestResults();
      renderHistory();
      renderTrendChart();
    }
    
    function exportData() {
      const history = getTestHistory();
      const dataStr = JSON.stringify(history, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `lin-test-history-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
    }
    
    function clearHistory() {
      if (confirm('Are you sure you want to clear all test history?')) {
        localStorage.removeItem('linTestHistory');
        refreshDashboard();
      }
    }
    
    // Initialize dashboard
    refreshDashboard();
    
    // Auto-refresh every 30 seconds if page is visible
    setInterval(() => {
      if (!document.hidden) {
        refreshDashboard();
      }
    }, 30000);
  </script>
</body>
</html>

